<html>
<head>
	<title>Clusto Web</title>
	<link rel="stylesheet" type="text/css" href="css/base.css" />
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript">
	var apiurl = 'http://mgmt.digg.internal:9999';

	function update_type(data) {
		data.sort();
		$.each(data, function(i, item) {
		});
	}

	function item_action(evt) {
		console.warn('Not implemented');
	}

	function item_detail(evt) {
		name = evt.target.name;
		$.getJSON(apiurl + name + '/?format=json&callback=?', function(data) {
			$('#detail').html('<fieldset><legend>' + data['object'] + '</legend><ul class="attrs"></ul></fieldset><fieldset><legend>Contents</legend><ul class="contents"></ul></fieldset><fieldset><legend>Parents</legend><ul class="parents"></ul></fieldset><fieldset><legend>Actions</legend><ul class="actions"></ul></fieldset>');
			data.attrs.sort();
			$.each(data.attrs, function(i, attr) {
				/*if(attr.value == null) { attr.value = '&nbsp;'; }
				if(attr.subkey == null) { attr.subkey = '&nbsp;'; }
				if(attr['number'] == null) { attr['number'] = '&nbsp;'; }*/
				$('#detail .attrs').append('<li><div class="col key">' + attr.key + '</div><div class="col value">' + attr.value + '</div><div class="col subkey">' + attr.subkey + '</div><div class="col number">' + attr['number'] + '</div><div class="col datatype">' + attr.datatype + '</div></li>');
			});

			data.contents.sort();
			$.each(data.contents, function(i, child) {
				$('#detail .contents').append('<li><a href="#top" class="child" name="' + child + '">' + child + '</a></li>');
				$('a[name=' + child + ']').click(item_detail);
			});

			data.parents.sort();
			$.each(data.parents, function(i, p) {
				$('#detail .parents').append('<li><a href="#top" class="parent" name="' + p + '">' + p + '</a></li>');
				$('a[name=' + p + ']').click(item_detail);
			});

			data.actions.sort();
			$.each(data.actions, function(i, action) {
				aname = data['object'] + '/' + action;
				$('#detail .actions').append('<li><a href="#top" class="action" name="' + aname + '">' + action + '</a></li>');
				$('a[name=' + aname + ']').click(item_action);
			});
		});
	}

	function toggle_type(evt) {
		id = evt.target.parentNode.id;
		type = id.split('_')[1];

		if(evt.target.className == 'item') {
			return;
		}

		if($('#' + id + ' .item').length > 0) {
			$('#' + id + ' .item').toggle();
		}else{
			$.getJSON(apiurl + '/' + type + '/?format=json&callback=?', function(items) {
				items.sort();
				$.each(items, function(x, item) {
					$('#' + id).append('<a class="item" href="#top" name="' + item + '">' + item.split('/')[2] + '</a>');
				});
				$('#' + id + ' .item').click(item_detail);
			});
		}
	}

	$(document).ready(function() {
		$('#filters').html('');
		types = [
			['Pools', 'pool'],
			['Datacenters', 'datacenter'],
			['Racks', 'rack'],
			['Servers', 'server'],
			['Network switches', 'networkswitch'],
			['Console servers', 'consoleserver'],
			['Power strips', 'powerstrip'],
			['Resources', 'resource']
		];
		$.each(types, function(i, name) {
			$('#filters').append('<fieldset id="type_' + name[1] + '"><legend>' + name[0] + '</legend></fieldset>');
		});

		$('#filters fieldset').click(toggle_type);
	});
	</script>
</head>

<body>
<div id="container">
	<a name="top"></a>
	<div id="filters">
		<fieldset id="pools">
			<legend>Pools</legend>
		</fieldset>
	</div>

	<div id="detail"></div>
</div>
</body>
</html>
